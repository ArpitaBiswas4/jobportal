<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/header :: head}"></head>
<body>
<nav th:replace="~{fragments/header :: navbar}"></nav>

<main class="container py-5">
  <div class="row">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h2 class="card-title" th:text="${job.title}"></h2>
              <h4 class="text-muted">
                <i class="fas fa-building"></i> <span th:text="${job.company}"></span>
              </h4>
            </div>
            <span class="badge bg-success" th:if="${job.status.name() == 'ACTIVE'}">Active</span>
            <span class="badge bg-secondary" th:if="${job.status.name() == 'CLOSED'}">Closed</span>
          </div>

          <div th:if="${error}" class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i> <span th:text="${error}"></span>
          </div>

          <hr>

          <div class="mb-4">
            <h5><i class="fas fa-info-circle"></i> Job Details</h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <strong><i class="fas fa-map-marker-alt"></i> Location:</strong>
                <span th:text="${job.location}"></span>
              </li>
              <li class="mb-2">
                <strong><i class="fas fa-briefcase"></i> Job Type:</strong>
                <span class="badge bg-info text-dark" th:text="${job.jobType}"></span>
              </li>
              <li class="mb-2" th:if="${job.salaryMin != null and job.salaryMax != null}">
                <strong><i class="fas fa-money-bill-wave"></i> Salary Range:</strong>
                $<span th:text="${#numbers.formatDecimal(job.salaryMin, 0, 'COMMA', 0, 'POINT')}"></span> -
                $<span th:text="${#numbers.formatDecimal(job.salaryMax, 0, 'COMMA', 0, 'POINT')}"></span>
              </li>
              <li class="mb-2">
                <strong><i class="fas fa-calendar-alt"></i> Posted:</strong>
                <span th:text="${#temporals.format(job.postedDate, 'MMMM dd, yyyy')}"></span>
              </li>
              <li class="mb-2" th:if="${job.closingDate != null}">
                <strong><i class="fas fa-calendar-times"></i> Closing Date:</strong>
                <span th:text="${#temporals.format(job.closingDate, 'MMMM dd, yyyy')}"></span>
              </li>
            </ul>
          </div>

          <hr>

          <div class="mb-4">
            <h5><i class="fas fa-file-alt"></i> Job Description</h5>
            <p class="text-justify" th:text="${job.description}" style="white-space: pre-wrap;"></p>
          </div>

          <hr th:if="${job.requirements != null}">

          <div class="mb-4" th:if="${job.requirements != null}">
            <h5><i class="fas fa-check-circle"></i> Requirements</h5>
            <p class="text-justify" th:text="${job.requirements}" style="white-space: pre-wrap;"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Application Card -->
    <div class="col-md-4">
      <div class="card shadow sticky-top" style="top: 20px;">
        <div class="card-body">
          <h5 class="card-title">Apply for this job</h5>

          <div sec:authorize="!isAuthenticated()">
            <p class="text-muted">Please login to apply for this job</p>
            <a href="/login" th:href="@{/login}" class="btn btn-primary w-100 mb-2">
              <i class="fas fa-sign-in-alt"></i> Login
            </a>
            <a href="/register" th:href="@{/register}" class="btn btn-outline-primary w-100">
              <i class="fas fa-user-plus"></i> Register
            </a>
          </div>

          <div sec:authorize="hasRole('APPLICANT')">
            <form th:action="@{/applicant/apply/{id}(id=${job.jobId})}" method="post">
              <div class="mb-3">
                <label for="coverLetter" class="form-label">Cover Letter (Optional)</label>
                <textarea class="form-control" id="coverLetter" name="coverLetter"
                          rows="5" placeholder="Tell us why you're a great fit..."></textarea>
              </div>
              <button type="submit" class="btn btn-success w-100"
                      th:disabled="${job.status.name() == 'CLOSED'}">
                <i class="fas fa-paper-plane"></i> Apply Now
              </button>
            </form>
          </div>

          <div sec:authorize="hasRole('EMPLOYER')">
            <p class="text-muted">
              <i class="fas fa-info-circle"></i> Employers cannot apply for jobs
            </p>
          </div>

          <hr>

          <div class="text-center">
            <a href="/jobs" th:href="@{/jobs}" class="btn btn-outline-secondary">
              <i class="fas fa-arrow-left"></i> Back to Jobs
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>